{% extends "base.html" %}
{% load staticfiles %}
{% load widget_tweaks %}
{% block extra_stylesheet %}
    <style>
        .gallery-wrap .img-big-wrap img {
            height: 450px;
            width: 100%;
            display: inline-block;
            cursor: zoom-in;
        }

        .gallery-wrap .img-small-wrap .item-gallery {
            width: 60px;
            height: 60px;
            border: 1px solid #ddd;
            margin: 7px 2px;
            display: inline-block;
            overflow: hidden;
        }

        .gallery-wrap .img-small-wrap {
            text-align: center;
        }

        .gallery-wrap .img-small-wrap img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
            border-radius: 4px;
            cursor: zoom-in;
        }
    </style>

{% endblock %}
{% block content %}



    <div class="container">
        <div class="card">
            <div class="row">
                <aside class="col-sm-5 border-right">
                    <article class="gallery-wrap">
                        <div class="img-big-wrap">
                            {% for image in item.item_images.all %}
                                {% if forloop.first %}
                                    {% if image.document %}
                                        <div><a href="#"><img src="{{ image.document.url }}" class="img-responsive"></a>
                                        </div>

                                    {% endif %}
                                {% endif %}
                            {% empty %}

                                <div><a href="#"><img src="{% static 'images/default.jpg' %}"
                                                      class="img-responsive"></a></div>
                            {% endfor %}

                        </div> <!-- slider-product.// -->

                        <div class="img-small-wrap">{% for image in item.item_images.all %}
                            <div class="item-gallery"><img src="{{ image.document.url }}"></div>
                        {% empty %}

                            <div class="item-gallery"><img src="{% static 'images/default.jpg' %}"></div>
                        {% endfor %}
                        </div>


                        <!-- slider-nav.// -->
                    </article> <!-- gallery-wrap .end// -->
                </aside>
                <aside class="col-sm-7">
                    <article class="card-body p-5">
                        <h3 class="title mb-3">{{ item.name }}</h3>

                        <p class="price-detail-wrap">
	<span class="price h3 text-warning"> 
		<span class="currency">Rs</span><span class="num">{{ item.stock_record.price_excl_tax }}</span>
	</span>
                            <span></span>
                        </p> <!-- price-detail-wrap .// -->
                        <dl class="item-property">
                            <dt>comment</dt>
                            <dd><p>{{ item.comment }}</p></dd>
                        </dl>


                        <hr>
                        <div class="row">
                            <div class="col-sm-5">
                                <dl class="param param-inline">

                                    {% if data == 0 %}
                                        {% if item_count > 0 %}
                                            <form action="" method="POST" enctype="multipart/form-data">
                                                {% csrf_token %}
                                                {{ quantity_form }}
                                                <button type="submit">Comment</button>
                                            </form>
                                        {% else %}
                                            <p class="text-danger">Item Out Of Stock</p>

                                        {% endif %}

                                    {% else %}
                                        <a href="{% url 'carts:cart' %}" class="btn btn-primary">Go To Cart</a>
                                    {% endif %}
                                </dl>  <!-- item-property .// -->
                            </div> <!-- col.// -->
                        </div> <!-- row.// -->

                    </article> <!-- card-body.// -->
                </aside> <!-- col.// -->
            </div> <!-- row.// -->
        </div> <!-- card.// -->

        <hr>
        <div class="product-ratings">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">sadf</div>
                        <div class="col-6">
                            Rate this product
                            <form action="" id='id_rating_form' method="post">
                                {% csrf_token %}
                                {% render_field rating_form.rating hidden='' %}
                                <ul class="rating" style=" list-style-type: none;
                                                margin: 0;
                                                padding: 0;
                                                overflow: hidden; ">
                                    <li class="float-left">

                                        <button id="1" onclick="myFunction(this.id);" type="button">
                                            <i class="fa fa-star blue-text"></i>
                                        </button>

                                    </li>
                                    <li class="float-left">

                                        <button id="2" class="{{ item.slug }}"
                                                onclick="myFunction(this.id);" type="button">
                                            <i class="fa fa-star blue-text"></i>
                                        </button>
                                    </li>
                                    <li class="float-left">

                                        <button id="3" onclick="myFunction(this.id);" type="button">
                                            <i class="fa fa-star blue-text"></i>
                                        </button>
                                    </li>
                                    <li class="float-left">

                                        <button id="4" onclick="myFunction(this.id);" type="button">
                                            <i class="fa fa-star blue-text"></i>
                                        </button>
                                    </li>
                                    <li class="float-left">

                                        <button id="5" onclick="myFunction(this.id);" type="button">
                                            <i class="fa fa-star blue-text"></i>
                                        </button>
                                    </li>
                                </ul>
                            </form>

                        </div>
                    </div>

                </div>
            </div>
        </div>
        <h1>Product Reviews</h1>
        {% if request.session.guest_email_id or request.user.is_authenticated %}

            <form action="" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                {% render_field form.comment class='form-control' placeholder='comment here.....' %}
                <button type="submit" class="pull-right btn btn-primary">Comment</button>
            </form>
        {% endif %}

        {% for comment in comments %}
            <div class="row ">
                <!--Image column-->

                <div class="col-lg-2  col-sm-2 col-12 mb-2">
                    <img src="https://mdbootstrap.com/img/Photos/Avatars/img (8).jpg" alt="sample image"
                         class="img-fluid rounded-circle z-depth-1-half">
                </div>
                <!--/.Image column-->

                <!--Content column-->
                <div class="col-lg-8 offset-lg-1 col-sm-10 col-12">
                    <a>
                        <h5 class="user-name font-weight-bold">{% if not comment.user.full_name == None %}
                            {{ comment.user.full_name }}  {% else %} Authorised User {% endif %}</h5>
                    </a>
                    <!-- Rating -->

                    <div class="card-data">
                        <ul class="list-unstyled mb-1">
                            <li class="comment-date font-small grey-text">
                                <i class="fa fa-clock-o"></i> {{ comment.created_at }}
                            </li>
                        </ul>
                    </div>
                    <p class="dark-grey-text article">{{ comment.comment }}</p>
                </div>
                <!--/.Content column-->
            </div>
            <hr>
        {% endfor %}

    </div>
    <div id="output">

    </div>
    <!--container.//-->

    {% block extra_script %}
        <script>


            $(function () {
                quantity ={{ item_count }};

                for (i = 1; i < quantity + 1; i++) {
                    $('#id_quantity').append('<option value="' + i + '">' + i + '</option>');
                }
            });


        </script>

        <script>
            let slug = "{{item.slug}}";
            function myFunction(id) {
                $('#id_rating').val(id);

                let iUrl = '/ratings/' + slug;
                $.ajax({
                    url: iUrl,
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        'rating': id,
                        'slug': slug,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        $('#output').html(data); // append to inner html

                    }
                });


            }
        </script>
    {% endblock %}

{% endblock content %}
